@model KanbanBoard.Models.DashboardModel
@{
    ViewData["Title"] = "Dashboard";
}

<script>
    $(function () {
        $("#LicentaOpen, #LicentaDevelopment, #LicentaTesting, #LicentaClosed").sortable({
            connectWith: "#LicentaOpen, #LicentaDevelopment, #LicentaTesting, #LicentaClosed",

            update: function (event, ui) {
                if (this === ui.item.parent()[0]) {
                    var data = $(this).sortable('serialize');
                    // POST to server using $.post or $.ajax
                    alert(ui.item.parent()[0].id),
                        $.ajax({
                            data: { 'id': 5 },
                            type: 'POST',
                            url: '/DashBoard/Actualize'
                        });
                }
            }
        });
        

    });
</script>

<div class="row">
    <div class="col-md-4 col-lg-3 col-xl-2 text-center">
        <a class="btn btn-primary btn-lg mb-3 col-sm-12" asp-controller="Issue" asp-action="Create">Create new issue</a>
        <button class="filter btn btn-info mb-3" data-toggle="collapse" data-target="#filter">
            Filters
        </button>
        <div id="filter" class="collapse padding">
            <div class="container-fluid padding">
                <div class="row">
                    <a>Project</a>
                </div>
                <div class="row">
                    <a>User</a>
                </div>
            </div>
        </div>
    </div>
    <div class="vl col-md-8 col-lg-9 col-xl-10">
        <button class="testez btn btn-secondary" data-toggle="collapse" data-target="#backlog">
            Open Backlog
            <i class="fas fa-chevron-down"></i>
        </button>
        <div id="backlog" class="collapse padding">
            <div class="container-fluid padding">
                <div class="row padding">
                    @foreach (var issue in Model.issues.Where(i => i.State.Name == "Backlog"))
                    {
                        <div class="card cardbacklog border-dark">
                            <div class="card-header">
                                <i class="fas fa-exclamation-circle priority-@issue.Priority.Name.ToLower()"></i>
                                <a>ID: @issue.ID</a>
                                <a asp-controller="Issue" asp-action="Edit" asp-route-id="@issue.ID"> <i class="fas fa-edit float-right"></i></a>
                            </div>
                            <div class="card-body text-dark">
                                @*<h5 class="card-title">Dark card title</h5>*@
                                <div class="card-text"><small>@issue.Summary</small></div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
        <hr />

        @foreach (var project in Model.projects)
        {<div class="container-fluid padding">

                <button class="testez btn btn-secondary" data-toggle="collapse" data-target="#@project.ProjectName">
                    @project.ProjectName
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div id="@project.ProjectName">
                    <div class="row padding">
                        <div class="col-6 col-lg-4 col-xl-3 vl-right">
                            <div class="row text-center">
                                <div class="col-12">
                                    <h5>
                                        Open
                                    </h5>
                                    <hr />
                                </div>
                            </div>
                            <div id="@(project.ProjectName+"Open")">
                                @foreach (var issue in project.Tasks.Where(i => i.State.Name == "Open"))
                                {
                                    <div class="card cardother border-dark">
                                        <div class="card-header">
                                            <i class="fas fa-exclamation-circle priority-@issue.Priority.Name.ToLower()"></i>
                                            <a>ID: @issue.ID</a>
                                            <a asp-controller="Issue" asp-action="Edit" asp-route-id="@issue.ID"> <i class="fas fa-edit float-right"></i></a>
                                        </div>
                                        <div class="card-body text-dark">
                                            @*<h5 class="card-title">Dark card title</h5>*@
                                            <div class="card-text"><small>@issue.Summary</small></div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="col-6 col-lg-4 col-xl-3 vl-right">
                            <div class="row text-center">
                                <div class="col-12">
                                    <h5>
                                        Development
                                    </h5>
                                    <hr />
                                </div>
                            </div>
                            <div id="@(project.ProjectName+"Development")">
                                @foreach (var issue in project.Tasks.Where(i => i.State.Name == "Development"))
                                {
                                    <div class="card cardother border-dark">
                                        <div class="card-header">
                                            <i class="fas fa-exclamation-circle priority-@issue.Priority.Name.ToLower()"></i>
                                            <a>ID: @issue.ID</a>
                                            <a asp-controller="Issue" asp-action="Edit" asp-route-id="@issue.ID"> <i class="fas fa-edit float-right"></i></a>
                                        </div>
                                        <div class="card-body text-dark">
                                            @*<h5 class="card-title">Dark card title</h5>*@
                                            <div class="card-text"><small>@issue.Summary</small></div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="col-6 col-lg-4 col-xl-3 vl-right">
                            <div class="row text-center">
                                <div class="col-12">
                                    <h5>
                                        Testing
                                    </h5>
                                    <hr />
                                </div>
                            </div>
                            <div id="@(project.ProjectName+"Testing")">
                                @foreach (var issue in project.Tasks.Where(i => i.State.Name == "Testing"))
                                {
                                    <div class="card cardother border-dark">
                                        <div class="card-header">
                                            <i class="fas fa-exclamation-circle priority-@issue.Priority.Name.ToLower()"></i>
                                            <a>ID: @issue.ID</a>
                                            <a asp-controller="Issue" asp-action="Edit" asp-route-id="@issue.ID"> <i class="fas fa-edit float-right"></i></a>
                                        </div>
                                        <div class="card-body text-dark">
                                            @*<h5 class="card-title">Dark card title</h5>*@
                                            <div class="card-text"><small>@issue.Summary</small></div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                        <div class="col-6 col-lg-4 col-xl-3 vl-right">
                            <div class="row text-center">
                                <div class="col-12">
                                    <h5>
                                        Closed
                                    </h5>
                                    <hr />
                                </div>
                            </div>
                            <div id="@(project.ProjectName+"Closed")">
                                @foreach (var issue in project.Tasks.Where(i => i.State.Name == "Closed"))
                                {
                                    <div class="card cardother border-dark">
                                        <div class="card-header">
                                            <i class="fas fa-exclamation-circle priority-@issue.Priority.Name.ToLower()"></i>
                                            <a>ID: @issue.ID</a>
                                            <a asp-controller="Issue" asp-action="Edit" asp-route-id="@issue.ID"> <i class="fas fa-edit float-right"></i></a>
                                        </div>
                                        <div class="card-body text-dark">
                                            @*<h5 class="card-title">Dark card title</h5>*@
                                            <div class="card-text"><small>@issue.Summary</small></div>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                <hr />
            </div>
            }
        </div>
    </div>
